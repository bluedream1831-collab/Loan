<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶œåˆè²¸æ¬¾è¨ˆç®—å™¨ (æˆ¿è²¸/ä¿¡è²¸/è»Šè²¸)</title>
    <!-- å¼•å…¥ Tailwind CSS é€²è¡Œå¿«é€Ÿæ’ç‰ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Chart.js é€²è¡Œåœ–è¡¨ç¹ªè£½ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f3f4f6; }
        .input-group label { display: block; font-size: 0.875rem; color: #4b5563; margin-bottom: 0.25rem; }
        .input-group input { width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; }
        .result-card { transition: all 0.3s; }
        .result-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="p-6">

    <div class="max-w-6xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800">å…¨æ–¹ä½è²¸æ¬¾æ”¯å‡ºè¨ˆç®—å™¨</h1>
            <p class="text-gray-500 mt-2">æ•´åˆæˆ¿è²¸ã€ä¿¡è²¸ã€è»Šè²¸ï¼Œä¸€éµè¨ˆç®—æ¯æœˆç¾é‡‘æµå£“åŠ›</p>
        </header>

        <!-- ä¸»è¦å…§å®¹å€ï¼šå·¦å´è¼¸å…¥ï¼Œå³å´ç¸½çµ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- å·¦å´ï¼šè¼¸å…¥å€å¡Š -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- æˆ¿è²¸å€å¡Š -->
                <div class="bg-white p-6 rounded-lg shadow border-l-4 border-blue-500">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-blue-100 text-blue-600 p-2 rounded-full mr-2">ğŸ </span> æˆ¿å±‹è²¸æ¬¾
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="input-group">
                            <label>è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label>
                            <input type="number" id="house-amount" value="1000" oninput="calculate()">
                        </div>
                        <div class="input-group">
                            <label>å¹´åˆ©ç‡ (%)</label>
                            <input type="number" id="house-rate" value="2.1" step="0.01" oninput="calculate()">
                        </div>
                        <div class="input-group">
                            <label>è²¸æ¬¾æœŸé™ (å¹´)</label>
                            <input type="number" id="house-years" value="30" oninput="calculate()">
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-blue-600 font-semibold" id="house-result">æ¯æœˆ: $0</div>
                </div>

                <!-- ä¿¡è²¸å€å¡Š -->
                <div class="bg-white p-6 rounded-lg shadow border-l-4 border-green-500">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-green-100 text-green-600 p-2 rounded-full mr-2">ğŸ’³</span> ä¿¡ç”¨è²¸æ¬¾
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="input-group">
                            <label>è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label>
                            <input type="number" id="personal-amount" value="0" oninput="calculate()">
                        </div>
                        <div class="input-group">
                            <label>å¹´åˆ©ç‡ (%)</label>
                            <input type="number" id="personal-rate" value="3.5" step="0.01" oninput="calculate()">
                        </div>
                        <div class="input-group">
                            <label>è²¸æ¬¾æœŸé™ (å¹´)</label>
                            <input type="number" id="personal-years" value="7" oninput="calculate()">
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-green-600 font-semibold" id="personal-result">æ¯æœˆ: $0</div>
                </div>

                <!-- è»Šè²¸å€å¡Š -->
                <div class="bg-white p-6 rounded-lg shadow border-l-4 border-orange-500">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-orange-100 text-orange-600 p-2 rounded-full mr-2">ğŸš—</span> æ±½è»Šè²¸æ¬¾
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="input-group">
                            <label>è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label>
                            <input type="number" id="car-amount" value="0" oninput="calculate()">
                        </div>
                        <div class="input-group">
                            <label>å¹´åˆ©ç‡ (%)</label>
                            <input type="number" id="car-rate" value="4.0" step="0.01" oninput="calculate()">
                        </div>
                        <div class="input-group">
                            <label>è²¸æ¬¾æœŸé™ (å¹´)</label>
                            <input type="number" id="car-years" value="5" oninput="calculate()">
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-orange-600 font-semibold" id="car-result">æ¯æœˆ: $0</div>
                </div>
            </div>

            <!-- å³å´ï¼šç¸½çµå„€è¡¨æ¿ -->
            <div class="lg:col-span-1 space-y-6">
                <!-- çµæœå¡ç‰‡ -->
                <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg result-card">
                    <h3 class="text-lg font-semibold text-gray-300 mb-2">æ¯æœˆç¸½ç¾é‡‘æ”¯å‡º</h3>
                    <div class="text-4xl font-bold text-yellow-400" id="total-monthly">$0</div>
                    <div class="mt-4 border-t border-gray-600 pt-4">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-400">æ¯å¹´ç¸½æ”¯å‡º</span>
                            <span class="font-bold" id="total-yearly">$0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">ç¸½åˆ©æ¯æ”¯å‡º (é ä¼°)</span>
                            <span class="font-bold text-red-300" id="total-interest">$0</span>
                        </div>
                    </div>
                </div>

                <!-- åœ–è¡¨å€ -->
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="text-center font-bold text-gray-700 mb-2">æ¯æœˆé‚„æ¬¾ä½”æ¯”</h4>
                    <canvas id="loanChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let loanChart;

        // åˆå§‹åŒ–åœ–è¡¨
        function initChart() {
            const ctx = document.getElementById('loanChart').getContext('2d');
            loanChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æˆ¿è²¸', 'ä¿¡è²¸', 'è»Šè²¸'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#3b82f6', '#22c55e', '#f97316'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // PMT å…¬å¼ï¼šæœ¬æ¯å¹³å‡æ”¤é‚„
        // P: è²¸æ¬¾ç¸½é¡, r: æœˆåˆ©ç‡, n: ç¸½æœŸæ•¸(æœˆ)
        function calculatePMT(P, annualRate, years) {
            if (P <= 0 || years <= 0) return { monthly: 0, total: 0, interest: 0 };
            
            let r = (annualRate / 100) / 12; // æœˆåˆ©ç‡
            let n = years * 12; // ç¸½æœˆæ•¸

            // å¦‚æœåˆ©ç‡ç‚º 0
            if (r === 0) {
                let monthly = (P * 10000) / n;
                return {
                    monthly: monthly,
                    total: P * 10000,
                    interest: 0
                };
            }

            let monthlyPayment = (P * 10000 * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
            let totalPayment = monthlyPayment * n;
            let totalInterest = totalPayment - (P * 10000);

            return {
                monthly: monthlyPayment,
                total: totalPayment,
                interest: totalInterest
            };
        }

        function formatMoney(num) {
            return '$' + Math.round(num).toLocaleString();
        }

        function calculate() {
            // å–å¾—è¼¸å…¥å€¼
            const hAmount = parseFloat(document.getElementById('house-amount').value) || 0;
            const hRate = parseFloat(document.getElementById('house-rate').value) || 0;
            const hYears = parseFloat(document.getElementById('house-years').value) || 0;

            const pAmount = parseFloat(document.getElementById('personal-amount').value) || 0;
            const pRate = parseFloat(document.getElementById('personal-rate').value) || 0;
            const pYears = parseFloat(document.getElementById('personal-years').value) || 0;

            const cAmount = parseFloat(document.getElementById('car-amount').value) || 0;
            const cRate = parseFloat(document.getElementById('car-rate').value) || 0;
            const cYears = parseFloat(document.getElementById('car-years').value) || 0;

            // è¨ˆç®—å€‹åˆ¥è²¸æ¬¾
            const house = calculatePMT(hAmount, hRate, hYears);
            const personal = calculatePMT(pAmount, pRate, pYears);
            const car = calculatePMT(cAmount, cRate, cYears);

            // æ›´æ–°å€‹åˆ¥é¡¯ç¤º
            document.getElementById('house-result').innerText = `æ¯æœˆæ”¤é‚„: ${formatMoney(house.monthly)} | ç¸½åˆ©æ¯: ${formatMoney(house.interest)}`;
            document.getElementById('personal-result').innerText = `æ¯æœˆæ”¤é‚„: ${formatMoney(personal.monthly)} | ç¸½åˆ©æ¯: ${formatMoney(personal.interest)}`;
            document.getElementById('car-result').innerText = `æ¯æœˆæ”¤é‚„: ${formatMoney(car.monthly)} | ç¸½åˆ©æ¯: ${formatMoney(car.interest)}`;

            // è¨ˆç®—ç¸½å’Œ
            const totalMonthly = house.monthly + personal.monthly + car.monthly;
            const totalYearly = totalMonthly * 12;
            const totalInterestAll = house.interest + personal.interest + car.interest;

            // æ›´æ–°ç¸½çµå„€è¡¨æ¿
            document.getElementById('total-monthly').innerText = formatMoney(totalMonthly);
            document.getElementById('total-yearly').innerText = formatMoney(totalYearly);
            document.getElementById('total-interest').innerText = formatMoney(totalInterestAll);

            // æ›´æ–°åœ–è¡¨
            if (loanChart) {
                loanChart.data.datasets[0].data = [house.monthly, personal.monthly, car.monthly];
                
                // å¦‚æœå…¨éƒ¨éƒ½æ˜¯0ï¼Œé¡¯ç¤ºä¸€å€‹ç°è‰²çš„åœˆåœˆé¿å…åœ–è¡¨æ¶ˆå¤±ï¼ˆé¸æ“‡æ€§ï¼‰
                if (totalMonthly === 0) {
                   // loanChart.data.datasets[0].data = [1, 1, 1]; // åƒ…ä½œç¤ºæ„ï¼Œå¯¦éš›å¯éš±è—
                }
                loanChart.update();
            }
        }

        // é é¢åŠ è¼‰å¾Œåˆå§‹åŒ–
        window.onload = function() {
            initChart();
            calculate();
        };

    </script>
</body>
</html>
