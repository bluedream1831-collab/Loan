<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æº«é¦¨ç†è²¡ï½œå…¨æ–¹ä½è²¸æ¬¾è¨ˆç®—æ©Ÿ - WUCJ</title>
    <!-- å¼•å…¥ Tailwind CSS èˆ‡ Google Fonts (åœ“é«”) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', '"Microsoft JhengHei"', 'sans-serif'],
                    },
                    colors: {
                        cream: '#FFFBF5',
                        warm: {
                            50: '#FAF7F2',
                            100: '#F5EFE6',
                            200: '#E6DCC9',
                            500: '#B89F7D',
                            600: '#8C7051',
                            800: '#5D4037',
                        },
                        accent: {
                            house: '#D97706',   /* æº«æš–ç¥ç€ */
                            credit: '#65A30D',  /* æŠ¹èŒ¶ç¶  */
                            car: '#EA580C'      /* é™¶ç“¦ç´… */
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #FFFBF5; color: #5D4037; }
        
        /* è‡ªå®šç¾©æº«é¦¨æŒ‰éˆ• */
        .btn-warm { 
            background-color: #D97706; 
            color: white; 
            padding: 0.5rem 1rem; 
            border-radius: 9999px; /* åœ“è§’ */
            transition: all 0.3s;
            box-shadow: 0 4px 6px -1px rgba(217, 119, 6, 0.2);
        }
        .btn-warm:hover { background-color: #B45309; transform: translateY(-1px); }
        
        .btn-soft {
            background-color: #FFF;
            border: 2px solid #E6DCC9;
            color: #8C7051;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            transition: all 0.3s;
        }
        .btn-soft:hover { background-color: #F5EFE6; border-color: #B89F7D; }

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        .input-warm {
            background-color: #FFF;
            border: 1px solid #E6DCC9;
            border-radius: 0.75rem;
            padding: 0.5rem;
            width: 100%;
            color: #5D4037;
            transition: border-color 0.3s;
        }
        .input-warm:focus { outline: none; border-color: #D97706; ring: 2px solid #FEF3C7; }

        /* å¡ç‰‡æŸ”å’Œé™°å½± */
        .card-warm {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(93, 64, 55, 0.05);
            border: 1px solid #F5EFE6;
        }

        /* åˆ—å°è¨­å®šï¼šç¢ºä¿è½‰ PDF æ™‚ä¹¾æ·¨ */
        @media print {
            body { background-color: white; color: black; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .card-warm { box-shadow: none; border: 1px solid #eee; margin-bottom: 20px; page-break-inside: avoid; }
            .page-break { page-break-before: always; }
            /* å¼·åˆ¶èƒŒæ™¯è‰²åˆ—å° */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 min-h-screen">

    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="max-w-7xl mx-auto flex justify-between items-center mb-8 no-print pt-2">
        <div class="flex items-center gap-3">
            <div class="bg-orange-100 p-2 rounded-full text-2xl">ğŸ¡</div>
            <h1 class="text-2xl font-bold text-warm-800 tracking-wider">è²¸æ¬¾è¨ˆç®—æ©Ÿ</h1>
        </div>
        <a href="https://vocus.cc/user/@WUCJ" target="_blank" class="flex items-center gap-2 text-warm-600 hover:text-accent-house transition font-medium text-sm sm:text-base">
            <img src="https://ui-avatars.com/api/?name=WUCJ&background=B45309&color=fff" class="w-8 h-8 rounded-full shadow-sm">
            <span>è¿½è¹¤ WUCJ</span>
        </a>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="max-w-7xl mx-auto space-y-8">
        
        <!-- å·¥å…·åˆ— -->
        <div class="flex flex-wrap justify-between items-center bg-white p-4 rounded-2xl shadow-sm border border-warm-100 no-print">
            <div class="space-x-2 mb-2 sm:mb-0">
                <button onclick="document.getElementById('importFile').click()" class="btn-soft text-sm">
                    <i class="fas fa-folder-open"></i> è®€å–èˆŠæª”
                </button>
                <button onclick="exportData()" class="btn-soft text-sm">
                    <i class="fas fa-save"></i> å„²å­˜è¨­å®š
                </button>
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
            </div>
            <div>
                <!-- é€™è£¡å°±æ˜¯ç”Ÿæˆ PDF çš„è§¸ç™¼é» -->
                <button onclick="window.print()" class="btn-warm text-sm font-bold flex items-center gap-2">
                    <i class="fas fa-print"></i> ä¸€éµåˆ—å° / å¦å­˜ PDF
                </button>
            </div>
        </div>

        <!-- åˆ—å°æ™‚çš„æ¨™é ­ (è¢å¹•éš±è—) -->
        <div class="hidden print-only text-center mb-8 border-b-2 border-warm-200 pb-4">
            <h1 class="text-3xl font-bold text-warm-800">å€‹äººè²¡å‹™è²¸æ¬¾è©¦ç®—å ±å‘Š</h1>
            <p class="text-warm-600 mt-1">Generated by WUCJ è²¸æ¬¾è¨ˆç®—æ©Ÿ</p>
        </div>

        <!-- è¼¸å…¥å€å¡Š (ä¸‰æ¬„å¼è¨­è¨ˆ) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 no-print">
            
            <!-- æˆ¿è²¸å¡ç‰‡ -->
            <div class="card-warm p-6 border-t-4 border-amber-500 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-amber-50 opacity-50 text-9xl pointer-events-none rotate-12">
                    <i class="fas fa-home"></i>
                </div>
                <h3 class="font-bold text-lg mb-5 text-warm-800 flex items-center">
                    <span class="w-2 h-8 bg-amber-500 rounded-full mr-3"></span>æˆ¿å±‹è²¸æ¬¾
                </h3>
                <div class="space-y-4 relative z-10">
                    <div><label class="text-xs text-warm-600 ml-1">è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label><input type="number" id="h-amt" class="input-warm" value="1000"></div>
                    <div class="flex gap-4">
                        <div class="w-1/2"><label class="text-xs text-warm-600 ml-1">å¹´åˆ©ç‡ (%)</label><input type="number" id="h-rate" class="input-warm" value="2.1" step="0.01"></div>
                        <div class="w-1/2"><label class="text-xs text-warm-600 ml-1">æœŸé™ (å¹´)</label><input type="number" id="h-year" class="input-warm" value="30"></div>
                    </div>
                    <div><label class="text-xs text-warm-600 ml-1">å¯¬é™æœŸ (åªç¹³æ¯å¹´æ•¸)</label><input type="number" id="h-grace" class="input-warm bg-orange-50" value="0"></div>
                </div>
            </div>

            <!-- ä¿¡è²¸å¡ç‰‡ -->
            <div class="card-warm p-6 border-t-4 border-lime-600 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-lime-50 opacity-50 text-9xl pointer-events-none rotate-12">
                    <i class="fas fa-coins"></i>
                </div>
                <h3 class="font-bold text-lg mb-5 text-warm-800 flex items-center">
                    <span class="w-2 h-8 bg-lime-600 rounded-full mr-3"></span>ä¿¡ç”¨è²¸æ¬¾
                </h3>
                <div class="space-y-4 relative z-10">
                    <div><label class="text-xs text-warm-600 ml-1">è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label><input type="number" id="p-amt" class="input-warm" value="0"></div>
                    <div class="flex gap-4">
                        <div class="w-1/2"><label class="text-xs text-warm-600 ml-1">å¹´åˆ©ç‡ (%)</label><input type="number" id="p-rate" class="input-warm" value="3.5" step="0.01"></div>
                        <div class="w-1/2"><label class="text-xs text-warm-600 ml-1">æœŸé™ (å¹´)</label><input type="number" id="p-year" class="input-warm" value="7"></div>
                    </div>
                </div>
            </div>

            <!-- è»Šè²¸å¡ç‰‡ -->
            <div class="card-warm p-6 border-t-4 border-orange-600 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-orange-50 opacity-50 text-9xl pointer-events-none rotate-12">
                    <i class="fas fa-car-side"></i>
                </div>
                <h3 class="font-bold text-lg mb-5 text-warm-800 flex items-center">
                    <span class="w-2 h-8 bg-orange-600 rounded-full mr-3"></span>æ±½è»Šè²¸æ¬¾
                </h3>
                <div class="space-y-4 relative z-10">
                    <div><label class="text-xs text-warm-600 ml-1">è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label><input type="number" id="c-amt" class="input-warm" value="0"></div>
                    <div class="flex gap-4">
                        <div class="w-1/2"><label class="text-xs text-warm-600 ml-1">å¹´åˆ©ç‡ (%)</label><input type="number" id="c-rate" class="input-warm" value="4.0" step="0.01"></div>
                        <div class="w-1/2"><label class="text-xs text-warm-600 ml-1">æœŸé™ (å¹´)</label><input type="number" id="c-year" class="input-warm" value="5"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ”¶å…¥èˆ‡è­¦ç¤º (ç¨ç«‹ä¸€æ’) -->
        <div class="card-warm p-6 bg-warm-50 border border-warm-200 no-print">
            <div class="flex flex-col md:flex-row items-center gap-6">
                <div class="w-full md:w-1/3">
                    <label class="font-bold text-warm-800"><i class="fas fa-wallet mr-2"></i>æœˆæ”¶å…¥è©¦ç®— (å…ƒ)</label>
                    <input type="number" id="income" class="input-warm mt-2 text-lg font-bold text-right" value="60000" placeholder="è¼¸å…¥æœˆè–ª">
                </div>
                <div class="w-full md:w-2/3">
                    <div id="dti-msg" class="hidden p-4 rounded-xl bg-rose-50 border border-rose-200 text-rose-800 text-sm">
                        <div class="font-bold mb-1 flex items-center"><i class="fas fa-exclamation-circle mr-2"></i> æ³¨æ„ï¼šè² å‚µæ¯”éé«˜</div>
                        æ‚¨çš„æœˆä»˜é‡‘å·²è¶…éæœˆæ”¶å…¥çš„ 60%ï¼Œå»ºè­°æ‚¨é‡æ–°æª¢è¦–è²¸æ¬¾çµæ§‹ã€‚
                        <a href="https://vocus.cc/user/@WUCJ" target="_blank" class="underline font-bold ml-1 hover:text-rose-600">ğŸ‘‰ é»æ­¤çœ‹ä½œè€…çš„å„ªåŒ–å»ºè­°</a>
                    </div>
                    <div id="dti-ok" class="hidden p-4 rounded-xl bg-green-50 border border-green-200 text-green-800 text-sm flex items-center">
                         <i class="fas fa-check-circle mr-2 text-xl"></i> 
                         <span>è²¡å‹™ç‹€æ³å¥åº·ï¼è² å‚µæ¯”åœ¨å®‰å…¨ç¯„åœå…§ã€‚</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å ±è¡¨é¡¯ç¤ºå€ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- åœ“é¤…åœ– -->
            <div class="card-warm p-6 flex flex-col items-center">
                <h4 class="text-warm-600 font-bold mb-4">æœˆä»˜é‡‘çµæ§‹åˆ†æ</h4>
                <div class="w-48 h-48 relative">
                    <canvas id="pieChart"></canvas>
                    <!-- ä¸­é–“é¡¯ç¤ºç¸½é‡‘é¡ -->
                    <div class="absolute inset-0 flex items-center justify-center flex-col pointer-events-none">
                        <span class="text-xs text-gray-400">æœˆä»˜ç¸½é¡</span>
                        <span class="font-bold text-lg text-warm-800" id="center-total">$0</span>
                    </div>
                </div>
            </div>

            <!-- æ•¸æ“šç¸½è¦½ -->
            <div class="md:col-span-2 card-warm p-6">
                <h4 class="text-warm-600 font-bold mb-4 border-b border-warm-100 pb-2">è²¡å‹™é æ¸¬æ‘˜è¦</h4>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center mb-6">
                    <div class="p-4 bg-orange-50 rounded-xl">
                        <div class="text-xs text-warm-500 mb-1">æ¯æœˆç¸½æ”¯å‡º</div>
                        <div class="text-xl font-bold text-accent-house" id="res-monthly">$0</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-xl">
                        <div class="text-xs text-warm-500 mb-1">æ¯å¹´æ”¯å‡º</div>
                        <div class="text-xl font-bold text-warm-800" id="res-yearly">$0</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-xl">
                        <div class="text-xs text-warm-500 mb-1">ç¸½åˆ©æ¯æ”¯å‡º</div>
                        <div class="text-xl font-bold text-warm-600" id="res-interest">$0</div>
                    </div>
                    <div class="p-4 bg-lime-50 rounded-xl">
                        <div class="text-xs text-warm-500 mb-1">è² å‚µæ¯” (DTI)</div>
                        <div class="text-xl font-bold text-accent-credit" id="res-dti">0%</div>
                    </div>
                </div>
                <!-- ç·šåœ– -->
                <div class="h-48">
                    <canvas id="scheduleChart"></canvas>
                </div>
            </div>
        </div>

        <!-- è©³ç´°è¡¨æ ¼ -->
        <div class="card-warm overflow-hidden">
            <div class="p-4 bg-warm-100 border-b border-warm-200 flex justify-between items-center">
                <h3 class="font-bold text-warm-800"><i class="fas fa-list-ul mr-2"></i>é‚„æ¬¾è¨ˆç•«è¡¨ (é è¦½å‰ 10 å¹´)</h3>
                <span class="text-xs text-warm-500 hidden sm:inline">å®Œæ•´è³‡æ–™è«‹ä½¿ç”¨åˆ—å°æˆ–åŒ¯å‡º</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-warm-50 text-warm-600">
                        <tr>
                            <th class="p-3 pl-6">æœŸæ•¸</th>
                            <th class="p-3">å¹´ä»½</th>
                            <th class="p-3 text-right">æœ¬æœˆæ‡‰ç¹³</th>
                            <th class="p-3 text-right text-warm-400">åˆ©æ¯</th>
                            <th class="p-3 text-right text-warm-400">æœ¬é‡‘</th>
                            <th class="p-3 text-right pr-6">å‰©é¤˜æœ¬é‡‘</th>
                        </tr>
                    </thead>
                    <tbody id="detail-table-body" class="divide-y divide-warm-100 text-warm-700">
                        <!-- JS å¡«å…¥ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é å°¾ -->
        <footer class="text-center text-warm-500 text-sm py-8 print-only-footer">
            <p class="mb-2">ç†è²¡è¦åŠƒãƒ»è²¸æ¬¾è©¦ç®—ãƒ»ç”Ÿæ´»æŠ•è³‡</p>
            <a href="https://vocus.cc/user/@WUCJ" target="_blank" class="inline-block px-4 py-2 rounded-full bg-white border border-warm-200 hover:bg-warm-50 transition">
                æ›´å¤šæ–‡ç« è«‹è‡³ <strong class="text-accent-house">WUCJ çš„æ–¹æ ¼å­</strong>
            </a>
            <p class="text-xs mt-4 opacity-60">è¨ˆç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›é‚„æ¬¾é‡‘é¡ä»¥éŠ€è¡Œåˆç´„ç‚ºæº–ã€‚</p>
        </footer>

    </div>

    <script>
        let scheduleChart, pieChart;
        const fmt = (n) => Math.round(n).toLocaleString();

        // è²¸æ¬¾é¡åˆ¥ (æ ¸å¿ƒé‚è¼¯ä¸è®Šï¼Œåƒ…é…è‰²èˆ‡è³‡æ–™æ•´åˆ)
        class Loan {
            constructor(amountWan, rate, years, graceYears = 0) {
                this.principal = amountWan * 10000;
                this.rate = rate / 100 / 12;
                this.periods = years * 12;
                this.gracePeriods = graceYears * 12;
            }
            getSchedule() {
                let schedule = [];
                let balance = this.principal;
                let amortizePeriods = this.periods - this.gracePeriods;
                let pmt = 0;

                if (amortizePeriods > 0 && this.rate > 0) {
                    pmt = (this.principal * this.rate * Math.pow(1 + this.rate, amortizePeriods)) / (Math.pow(1 + this.rate, amortizePeriods) - 1);
                } else if (amortizePeriods > 0 && this.rate === 0) {
                    pmt = this.principal / amortizePeriods;
                }

                for (let i = 1; i <= this.periods; i++) {
                    let interest = balance * this.rate;
                    let payment = (i <= this.gracePeriods) ? interest : pmt;
                    let principalPaid = payment - interest;
                    
                    if (i > this.gracePeriods) {
                        if (balance - principalPaid < 10) { principalPaid = balance; payment = principalPaid + interest; }
                    } else {
                        principalPaid = 0;
                    }

                    balance -= principalPaid;
                    if (balance < 0) balance = 0;

                    schedule.push({ month: i, payment, interest, principal: principalPaid, balance });
                }
                return schedule;
            }
        }

        function calculateAll() {
            // è®€å–æ•¸æ“š
            const inputs = {
                h: { amt: +document.getElementById('h-amt').value, rate: +document.getElementById('h-rate').value, yr: +document.getElementById('h-year').value, grace: +document.getElementById('h-grace').value },
                p: { amt: +document.getElementById('p-amt').value, rate: +document.getElementById('p-rate').value, yr: +document.getElementById('p-year').value },
                c: { amt: +document.getElementById('c-amt').value, rate: +document.getElementById('c-rate').value, yr: +document.getElementById('c-year').value },
                income: +document.getElementById('income').value
            };

            const loanH = new Loan(inputs.h.amt, inputs.h.rate, inputs.h.yr, inputs.h.grace);
            const loanP = new Loan(inputs.p.amt, inputs.p.rate, inputs.p.yr);
            const loanC = new Loan(inputs.c.amt, inputs.c.rate, inputs.c.yr);

            const sH = loanH.getSchedule();
            const sP = loanP.getSchedule();
            const sC = loanC.getSchedule();

            const maxMonths = Math.max(sH.length, sP.length, sC.length);
            let combined = [];
            let totalInterest = 0;

            for (let i = 0; i < maxMonths; i++) {
                const h = sH[i] || { payment: 0, interest: 0, principal: 0, balance: 0 };
                const p = sP[i] || { payment: 0, interest: 0, principal: 0, balance: 0 };
                const c = sC[i] || { payment: 0, interest: 0, principal: 0, balance: 0 };

                let rowPay = h.payment + p.payment + c.payment;
                let rowInt = h.interest + p.interest + c.interest;
                let rowPrin = h.principal + p.principal + c.principal;
                let rowBal = h.balance + p.balance + c.balance;

                totalInterest += rowInt;
                combined.push({ month: i+1, payment: rowPay, interest: rowInt, principal: rowPrin, balance: rowBal });
            }

            // æ›´æ–° UI
            const firstMonth = combined.length > 0 ? combined[0].payment : 0;
            document.getElementById('res-monthly').innerText = '$' + fmt(firstMonth);
            document.getElementById('res-yearly').innerText = '$' + fmt(firstMonth * 12);
            document.getElementById('res-interest').innerText = '$' + fmt(totalInterest);
            document.getElementById('center-total').innerText = '$' + fmt(firstMonth);

            // DTI
            const dti = inputs.income > 0 ? (firstMonth / inputs.income * 100) : 0;
            document.getElementById('res-dti').innerText = dti.toFixed(1) + '%';
            
            const warnBox = document.getElementById('dti-msg');
            const okBox = document.getElementById('dti-ok');
            if(dti > 60) {
                warnBox.classList.remove('hidden');
                okBox.classList.add('hidden');
                document.getElementById('res-dti').classList.add('text-rose-600');
            } else {
                warnBox.classList.add('hidden');
                okBox.classList.remove('hidden');
                document.getElementById('res-dti').classList.remove('text-rose-600');
            }

            // è¡¨æ ¼
            const tbody = document.getElementById('detail-table-body');
            tbody.innerHTML = '';
            combined.slice(0, 120).forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-orange-50 transition';
                tr.innerHTML = `
                    <td class="p-3 pl-6">${row.month}</td>
                    <td class="p-3 text-warm-400">ç¬¬ ${Math.ceil(row.month/12)} å¹´</td>
                    <td class="p-3 text-right font-bold text-warm-800">$${fmt(row.payment)}</td>
                    <td class="p-3 text-right text-warm-500 text-xs">$${fmt(row.interest)}</td>
                    <td class="p-3 text-right text-warm-500 text-xs">$${fmt(row.principal)}</td>
                    <td class="p-3 text-right pr-6 text-warm-400">$${fmt(row.balance)}</td>
                `;
                tbody.appendChild(tr);
            });

            // åœ–è¡¨æ›´æ–° (é…è‰²æ¡ç”¨æš–è‰²ç³»)
            updateCharts(combined, (sH[0]?.payment||0), (sP[0]?.payment||0), (sC[0]?.payment||0));
        }

        function updateCharts(data, h, p, c) {
            // ç·šåœ–è³‡æ–™
            let labels = [];
            let dataset = [];
            for(let i=0; i<data.length; i+=12) {
                labels.push(`ç¬¬${Math.ceil((i+1)/12)}å¹´`);
                dataset.push(data[i].payment);
            }

            // éŠ·æ¯€èˆŠåœ–è¡¨
            if(scheduleChart) scheduleChart.destroy();
            if(pieChart) pieChart.destroy();

            // å»ºç«‹ç·šåœ– (æš–æ£•è‰²ç³»)
            const ctxLine = document.getElementById('scheduleChart').getContext('2d');
            scheduleChart = new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ¯æœˆæ”¯å‡ºè¶¨å‹¢',
                        data: dataset,
                        borderColor: '#8C7051', // æš–æ£•
                        backgroundColor: 'rgba(140, 112, 81, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#D97706'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#F5EFE6' }, ticks: { color: '#8C7051' } },
                        x: { grid: { display: false }, ticks: { color: '#8C7051' } }
                    }
                }
            });

            // å»ºç«‹åœ“é¤…åœ– (å¤§åœ°è‰²ç³»)
            const ctxPie = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: ['æˆ¿è²¸', 'ä¿¡è²¸', 'è»Šè²¸'],
                    datasets: [{
                        data: [h, p, c],
                        backgroundColor: ['#D97706', '#65A30D', '#EA580C'], // ç¥ç€, æŠ¹èŒ¶, é™¶ç“¦
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, color: '#5D4037' } } }
                }
            });
        }

        function exportData() {
            const data = {
                hAmt: document.getElementById('h-amt').value, hRate: document.getElementById('h-rate').value, hYear: document.getElementById('h-year').value, hGrace: document.getElementById('h-grace').value,
                pAmt: document.getElementById('p-amt').value, pRate: document.getElementById('p-rate').value, pYear: document.getElementById('p-year').value,
                cAmt: document.getElementById('c-amt').value, cRate: document.getElementById('c-rate').value, cYear: document.getElementById('c-year').value,
                income: document.getElementById('income').value
            };
            const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "loan_warm_wucj.json";
            a.click();
        }

        function importData(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const d = JSON.parse(e.target.result);
                    document.getElementById('h-amt').value = d.hAmt||0; document.getElementById('h-rate').value = d.hRate||0; document.getElementById('h-year').value = d.hYear||0; document.getElementById('h-grace').value = d.hGrace||0;
                    document.getElementById('p-amt').value = d.pAmt||0; document.getElementById('p-rate').value = d.pRate||0; document.getElementById('p-year').value = d.pYear||0;
                    document.getElementById('c-amt').value = d.cAmt||0; document.getElementById('c-rate').value = d.cRate||0; document.getElementById('c-year').value = d.cYear||0;
                    document.getElementById('income').value = d.income||0;
                    calculateAll();
                } catch(err) { alert('æª”æ¡ˆæ ¼å¼ä¸ç¬¦'); }
            };
            reader.readAsText(file);
        }

        document.querySelectorAll('input').forEach(el => el.addEventListener('input', calculateAll));
        window.onload = calculateAll;
    </script>
</body>
</html>
